{
    "id": "monitoring-elasticity-schema.json",
    "$schema": "",
    "description": "Monitoring & Elasticity Schema for Microservice-based Aplications",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "Insight"
    ],
    "properties": {
        "Insight": {
            "id": "#/properties/Insight",
            "type": "array",
            "additionalProperties": false,
            "uniqueItems": true,
            "items": {
                "$ref": "#/definitions/Insight"
            }
        }
    },
    "definitions": {
        "Insight": {
            "id": "#/definitions/Insight",
            "required": [
                "SALIENCE",
                "COMPUTE",
                "EVERY"
            ],
            "properties": {
                "SALIENCE": {
                    "type": "number",
                    "minimum": 0
                },
                "CONFIDENCE": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 100
                },
                "SAMPLE": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 100
                },
                "COMPUTE": {
                    "type": {
                        "$ref": "#/definitions/CompositeExpression"
                    }
                },
                "EVERY": {
                    "id": "#/properties/EVERY",
                    "type": {
                        "$ref": "#/properties/Window"
                    }
                }
            }
        },
        "CompositeExpression": {
            "id": "#/definitions/CompositeExpression",
            "type": "object",
            "additionalProperties": false,
            "oneOf": [{
                    "required": [
                        "WHEN"
                    ],
                    "properties": {
                        "lhside": {
                            "$ref": "#/definitions/CompositeExpression"
                        },
                        "operation": {
                            "$ref": "#/definitions/BinOp"
                        },
                        "rhside": {
                            "$ref": "#/definitions/CompositeExpression"
                        },
                        "WHEN": {
                            "$ref": "#/definitions/Filter"
                        }
                    }
                },
                {
                    "$ref": "#/definitions/Expression"
                }
            ]
        },
        "BinOp": {
            "id": "#/definitions/BinOp",
            "type": "string",
            "enum": [
                "ADD",
                "MUL",
                "SUB",
                "DIV"
            ]
        },
        "Expression": {
            "id": "#/definitions/Expression",
            "type": "object",
            "additionalProperties": false,
            "oneOf": [{
                    "required": [
                        "MapOp",
                        "WHEN"
                    ],
                    "properties": {
                        "MapOp": {
                            "$ref": "#/definitions/MapOp"
                        },
                        "oneOf": [{
                                "Aggregate": {
                                    "$ref": "#/definitions/Aggregate"
                                }
                            },
                            {
                                "Members": {
                                    "$ref": "#/definitions/Members"
                                }
                            }
                        ],
                        "WHEN": {
                            "items": {
                                "$ref": "#/definitions/Aggregate"
                            }
                        }
                    }
                },
                {
                    "$ref": "#/definitions/Expression"
                }
            ]
        },
        "Aggregate": {
            "id": "#/definitions/Aggregate",
            "type": "object",
            "additionalProperties": false,
            "oneOf": [{
                    "properties": {
                        "WindowedFunc": {
                            "$ref": "#/definitions/WindowedFunc"
                        },
                        "Window": {
                            "$ref": "#/definitions/Window"
                        },
                        "Members": {
                            "$ref": "#/definitions/Members"
                        }
                    }
                },
                {
                    "properties": {
                        "AccumFunc": {
                            "$ref": "#/definitions/AccumFunc"
                        },
                        "Members": {
                            "$ref": "#/definitions/Members"
                        }
                    }
                }
            ]

        },
        "WindowedFunc": {
            "id": "#/definitions/BinOp",
            "type": "string",
            "enum": [
                "SUM",
                "PRODUCT",
                "ARITHMETICMEAN",
                "GEOMETRICMEAN",
                "MIN",
                "MAX",
                "VARIANCE",
                "SDEV",
                "MEDIAN",
                "MODE",
                "PERCENTILE"
            ]
        },
        "Members": {
            "id": "#/definitions/Members",
            "type": "object",
            "properties": {
                "Metric": {
                    "$ref": "#/definitions/Metric"
                },
                "Clusters": {
                    "$ref": "#/definitions/Clusters"
                }
            }
        },
        "Metric": {
            "id": "#/definitions/Metric",
            "type": "string"
        },
        "Clusters": {
            "id": "#/definitions/Clusters",
            "type": "array",
            "minItems": 0,
            "items": {
                "$ref": "#/definitions/Cluster"
            }
        },
        "Cluster": {
            "id": "#/definitions/Cluster",
            "type": "string"
        },
        "Filter": {
            "id": "#/definitions/Filter",
            "type": "object",
            "additionalProperties": false,
            "required": [
                "composition",
                "timeWindow",
                "timeStep"
            ],
            "composition": {
                "oneOf": [{
                        "$ref": "#/definitions/RelOp"
                    },
                    {
                        "$ref": "#/definitions/CompositeExpression"
                    },
                    {
                        "$ref": "#/definitions/RelOp"
                    }
                ]
            }
        },
        "RelOp": {
            "id": "#/definitions/RelOp",
            "type": "string",
            "enum": [
                ">",
                "<",
                "<=",
                ">=",
                "==",
                "!="
            ]
        },
        "Window": {
            "id": "#/definitions/Window",
            "type": "object",
            "additionalProperties": false,
            "required": [
                "duration",
                "unit"
            ],
            "properties": {
                "duration": {
                    "type": "number",
                    "minimum": 0
                },
                "unit": {
                    "$ref": "#/definitions/TimePeriod"
                }
            }
        },
        "TimePeriod": {
            "id": "#/definitions/TimePeriod",
            "type": "string",
            "enum": [
                "MILLISECONDS",
                "SECONDS",
                "MINUTES",
                "HOURS"
            ]
        },
        "AccumFunc": {
            "id": "#/definitions/AccumFunc",
            "type": "string",
            "enum": [
                "RUNNING_SDEV",
                "RUNNING_MEAN",
                "RUNNING_MAX",
                "RUNNING_MIN",
                "EWMA",
                "PEWMA"
            ]
        },
        "MapOp": {
            "id": "#/definitions/MapOp",
            "type": "string",
            "enum": [
                "ABS",
                "SQRT",
                "SQUARE"
            ]
        }
    }
}